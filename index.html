<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Punkte Zähler</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .results {
      margin-top: 20px;
      border-top: 2px solid #ccc;
      padding-top: 10px;
    }
    .hidden {
      display: none;
    }
    .participant-result {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .participant-result p {
      margin: 0;
    }
    .total-result {
      font-size: 1.5em;
      font-weight: bold;
      margin-top: 20px;
    }
    hr {
      margin-top: 20px;
      margin-bottom: 20px;
      border: 0;
      border-top: 1px solid #ccc;
    }
    .whatsapp-button {
      margin-top: 10px;
      background-color: #25D366;
      color: white;
      border: none;
      padding: 8px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
    }
    .whatsapp-button:hover {
      background-color: #128C7E;
    }
    #export-pdf {
      margin-top: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
    }
    #export-pdf:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Punkte Zähler</h1>

  <!-- Turnier -->
  <label for="tournament">Turnier</label>
  <input type="text" id="tournament" placeholder="Turniername">

  <!-- Name -->
  <label for="name">Name</label>
  <select id="name">
    <option value="" disabled selected>Bitte Name auswählen</option>
    <option>Paul Lüders</option>
    <option>Jan Grüning</option>
  </select>

  <!-- Runde -->
  <label for="round">Runde</label>
  <input type="number" id="round" value="1" readonly>

  <!-- Entfernung -->
  <label for="distance">Entfernung</label>
  <select id="distance">
    <option value="bitte auswählen">bitte auswählen</option>
    <option value="10m">10m</option>
    <option value="18m">18m</option>
    <option value="20m">20m</option>
    <option value="30m">30m</option>
    <option value="40m">40m</option>
    <option value="50m">50m</option>
  </select>

  <!-- Auflage -->
  <label for="target">Auflage</label>
  <select id="target">
    <option value="bitte auswählen">bitte auswählen</option>
    <option value="120cm">120 cm</option>
    <option value="80cm">80 cm</option>
    <option value="60cm">60 cm</option>
    <option value="40cm">40 cm</option>
  </select>

  <!-- Pfeile -->
  <label for="arrows">Pfeile</label>
  <select id="arrows">
    <option value="3">3</option>
    <option value="6">6</option>
  </select>

  <!-- Pfeil 1 bis Pfeil 6 -->
  <div id="arrow-points">
    <label for="arrow1">Pfeil 1</label>
    <select class="arrow-point" id="arrow1">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="X">X</option>
    </select>

    <label for="arrow2">Pfeil 2</label>
    <select class="arrow-point" id="arrow2">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="X">X</option>
    </select>

    <label for="arrow3">Pfeil 3</label>
    <select class="arrow-point" id="arrow3">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="X">X</option>
    </select>

    <!-- Pfeil 4 bis 6 -->
    <div id="extra-arrows" class="hidden">
      <label for="arrow4">Pfeil 4</label>
      <select class="arrow-point" id="arrow4">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="X">X</option>
      </select>

      <label for="arrow5">Pfeil 5</label>
      <select class="arrow-point" id="arrow5">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="X">X</option>
      </select>

      <label for="arrow6">Pfeil 6</label>
      <select class="arrow-point" id="arrow6">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="X">X</option>
      </select>
    </div>
  </div>

  <button id="submit-btn">Ergebnis Absenden</button>
  <button id="clear-btn">Formular Leeren</button>

  <div class="results">
    <h3>Ergebnisse</h3>
    <div id="result-list"></div>
  </div>

  <div id="export-pdf" class="hidden">Exportiere als PDF</div>

  <script>
    // Sicherstellen, dass die Teilnehmerergebnisse gespeichert bleiben
    function loadResults() {
      let results = JSON.parse(localStorage.getItem("results"));
      if (!results) {
        results = [];
      }
      return results;
    }

    // Speichern der aktuellen Ergebnisse
    function saveResults(results) {
      localStorage.setItem("results", JSON.stringify(results));
    }

    // Funktion zur Berechnung des Gesamtpunktes
    function calculateTotal(pointsArray) {
      return pointsArray.reduce((acc, points) => {
        return acc + (points === 'X' ? 10 : parseInt(points));
      }, 0);
    }

    // Ergebnisse anzeigen
    function displayResults() {
      const results = loadResults();
      const resultList = document.getElementById("result-list");
      resultList.innerHTML = ""; // Clear existing results

      results.forEach((result, index) => {
        const participantDiv = document.createElement("div");
        participantDiv.classList.add("participant-result");
        participantDiv.innerHTML = `
          <p><strong>Runde ${result.round}:</strong> ${result.name} - ${result.totalPoints} Punkte (${result.distance} ${result.target})</p>
          <button class="whatsapp-button" onclick="sendWhatsAppMessage('${result.name}', '${result.totalPoints}')">Teilen über WhatsApp</button>
        `;
        resultList.appendChild(participantDiv);
      });

      // Überprüfen, ob 10 Runden erreicht sind und den Export-Button anzeigen
      if (results.length >= 10) {
        document.getElementById("export-pdf").classList.remove("hidden");
      }
    }

    // WhatsApp Nachricht senden
    function sendWhatsAppMessage(name, points) {
      const message = `Ergebnis von ${name}: ${points} Punkte`;
      window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, "_blank");
    }

    // Ergebnis absenden
    document.getElementById("submit-btn").addEventListener("click", function() {
      const name = document.getElementById("name").value;
      const round = parseInt(document.getElementById("round").value);
      const distance = document.getElementById("distance").value;
      const target = document.getElementById("target").value;
      const arrows = parseInt(document.getElementById("arrows").value);

      // Punkte der Pfeile erfassen
      const arrowPoints = [];
      for (let i = 1; i <= arrows; i++) {
        arrowPoints.push(document.getElementById(`arrow${i}`).value);
      }

      const totalPoints = calculateTotal(arrowPoints);

      // Speichern der Runde und der Punkte
      const results = loadResults();
      results.push({
        round: round,
        name: name,
        distance: distance,
        target: target,
        arrowPoints: arrowPoints,
        totalPoints: totalPoints,
      });

      saveResults(results);

      // Runde erhöhen
      document.getElementById("round").value = round + 1;

      // Ergebnisse anzeigen
      displayResults();
    });

    // Formular zurücksetzen
    document.getElementById("clear-btn").addEventListener("click", function() {
      document.getElementById("tournament").value = "";
      document.getElementById("name").value = "";
      document.getElementById("distance").value = "bitte auswählen";
      document.getElementById("target").value = "bitte auswählen";
      document.getElementById("arrows").value = "3";
      document.getElementById("round").value = "1";

      // Alle Pfeile zurücksetzen
      for (let i = 1; i <= 6; i++) {
        document.getElementById(`arrow${i}`).value = "0";
      }
    });

    // Export als PDF
    document.getElementById("export-pdf").addEventListener("click", function() {
      const doc = new jsPDF();

      const results = loadResults();
      results.forEach((result, index) => {
        doc.text(`Runde ${result.round}: ${result.name} - ${result.totalPoints} Punkte`, 10, 10 + (index * 10));
      });

      doc.save('ergebnisse.pdf');
    });

    // Initialisieren
    displayResults();
  </script>

  <!-- jsPDF Script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</body>
</html>
