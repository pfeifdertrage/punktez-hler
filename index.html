<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Punkte Zähler</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .results {
      margin-top: 20px;
      border-top: 2px solid #ccc;
      padding-top: 10px;
    }
    .hidden {
      display: none;
    }
    .participant-result {
      margin-bottom: 10px;
    }
    .participant-result p {
      margin: 0;
    }
    .total-result {
      font-size: 1.5em;
      font-weight: bold;
      margin-top: 20px;
    }
    hr {
      margin-top: 20px;
      margin-bottom: 20px;
      border: 0;
      border-top: 1px solid #ccc;
    }
    .whatsapp-button {
      margin-top: 10px;
      background-color: #25D366;
      color: white;
      border: none;
      padding: 8px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
    }
    .whatsapp-button:hover {
      background-color: #128C7E;
    }
    .pdf-button {
      background-color: #4CAF50;
    }
    .pdf-button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Punkte Zähler</h1>
  
  <!-- Turnier -->
  <label for="tournament">Turnier</label>
  <input type="text" id="tournament" placeholder="Turniername">

  <!-- Name -->
  <label for="name">Name</label>
  <select id="name">
    <option value="" disabled selected>Bitte Name auswählen</option>
    <option>Paul Lüders</option>
    <option>Jan Grüning</option>
  </select>

  <!-- Runde -->
  <label for="round">Runde</label>
  <input type="number" id="round" value="1" readonly>

  <!-- Entfernung -->
  <label for="distance">Entfernung</label>
  <select id="distance">
    <option value="bitte auswählen">bitte auswählen</option>
    <option value="10m">10m</option>
    <option value="18m">18m</option>
    <option value="20m">20m</option>
    <option value="30m">30m</option>
    <option value="40m">40m</option>
    <option value="50m">50m</option>
  </select>

  <!-- Auflage -->
  <label for="target">Auflage</label>
  <select id="target">
    <option value="bitte auswählen">bitte auswählen</option>
    <option value="120cm">120 cm</option>
    <option value="80cm">80 cm</option>
    <option value="60cm">60 cm</option>
    <option value="40cm">40 cm</option>
  </select>

  <!-- Pfeile -->
  <label for="arrows">Pfeile</label>
  <select id="arrows">
    <option value="3">3</option>
    <option value="6">6</option>
  </select>

  <!-- Pfeil 1 bis Pfeil 6 -->
  <div id="arrow-points">
    <label for="arrow1">Pfeil 1</label>
    <select class="arrow-point" id="arrow1">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="X">X</option>
    </select>

    <label for="arrow2">Pfeil 2</label>
    <select class="arrow-point" id="arrow2">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="X">X</option>
    </select>

    <label for="arrow3">Pfeil 3</label>
    <select class="arrow-point" id="arrow3">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="X">X</option>
    </select>

    <!-- Pfeil 4 bis 6 -->
    <div id="extra-arrows" class="hidden">
      <label for="arrow4">Pfeil 4</label>
      <select class="arrow-point" id="arrow4">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="X">X</option>
      </select>

      <label for="arrow5">Pfeil 5</label>
      <select class="arrow-point" id="arrow5">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="X">X</option>
      </select>

      <label for="arrow6">Pfeil 6</label>
      <select class="arrow-point" id="arrow6">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="X">X</option>
      </select>
    </div>
  </div>

  <!-- Rundenpunkte -->
<label>Rundenpunkte</label>
<input type="number" id="round-points" value="0" readonly>

<!-- Gesamtpunkte -->
<label>Gesamtpunkte</label>
<input type="number" id="total-points" value="0" readonly>

<!-- Ergebnisse -->
<div class="results">
  <h3>Ergebnisse der Teilnehmer:</h3>
  <table id="participants-results" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>Name</th>
        <th>Rundenpunkte</th>
        <th>Erzielte X</th>
        <th>Gesamtpunkte</th>
        <th>Gesamt X</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dynamische Ergebnisse werden hier angezeigt -->
    </tbody>
  </table>
</div>

<!-- Gesamt X -->
<div class="total-result" id="total-x"></div>

<!-- PDF-Button -->
<button id="pdf-button" class="pdf-button hidden">PDF-Download</button>

<script>
  // Referenzen zu den Elementen
  const formFields = ['tournament', 'name', 'distance', 'target'];
  const roundPointsField = document.getElementById('round-points');
  const totalPointsField = document.getElementById('total-points');
  const participantsResults = document.getElementById('participants-results');
  const totalXDiv = document.getElementById('total-x');
  const submitButton = document.getElementById('submit');
  const clearButton = document.getElementById('clear');
  const arrowSelect = document.getElementById('arrows');
  const extraArrowsDiv = document.getElementById('extra-arrows');
  const pdfButton = document.getElementById('pdf-button');
  const roundField = document.getElementById('round');

  let totalPoints = 0;
  let totalX = 0;
  let currentRound = 1;

  // Lade gespeicherte Daten aus dem localStorage
  window.onload = function() {
    const storedData = JSON.parse(localStorage.getItem('tournamentData')) || {};
    
    // Setze gespeicherte Werte
    document.getElementById('tournament').value = storedData.tournament || '';
    document.getElementById('name').value = storedData.name || '';
    document.getElementById('distance').value = storedData.distance || '';
    document.getElementById('target').value = storedData.target || '';
    document.getElementById('round').value = storedData.round || 1;
    totalPoints = storedData.totalPoints || 0;
    totalX = storedData.totalX || 0;

    // Setze Teilnehmerergebnisse
    participantsResults.querySelector('tbody').innerHTML = storedData.participantsResults || '';
    totalXDiv.innerHTML = `<strong>Gesamt X:</strong> ${totalX}`;

    // Wenn es gespeicherte Daten gibt, wird die Rundenzahl fortgesetzt
    currentRound = storedData.round || 1;
  };

  // Zeigt zusätzliche Pfeile, wenn 6 Pfeile gewählt sind
  arrowSelect.addEventListener('change', () => {
    if (arrowSelect.value === '6') {
      extraArrowsDiv.classList.remove('hidden');
    } else {
      extraArrowsDiv.classList.add('hidden');
    }
  });

  // Berechne die Punkte für die Runde und aktualisiere die Anzeige
  submitButton.addEventListener('click', () => {
    let roundPoints = 0;
    let roundX = 0;
    let arrows = [];

    // Pfeilwerte sammeln
    for (let i = 1; i <= parseInt(arrowSelect.value); i++) {
      const arrowValue = document.getElementById(`arrow${i}`).value;
      arrows.push(arrowValue);
      if (arrowValue === 'X') {
        roundX++;
      } else {
        roundPoints += parseInt(arrowValue);
      }
    }

    // Runde und Gesamtpunkte anzeigen
    roundPointsField.value = roundPoints;
    totalPointsField.value = totalPoints + roundPoints;

    // Ergebnisse der Runde anzeigen
    const participantName = document.getElementById('name').value;
    const participantRow = document.createElement('tr');
    participantRow.innerHTML = `
      <td>${participantName}</td>
      <td>${roundPoints}</td>
      <td>${roundX}</td>
      <td>${totalPoints + roundPoints}</td>
      <td>${totalX + roundX}</td>
    `;
    
    // Füge das Ergebnis in die Tabelle ein
    participantsResults.querySelector('tbody').appendChild(participantRow);

    // Gesamt X anzeigen
    totalXDiv.innerHTML = `<strong>Gesamt X:</strong> ${totalX + roundX}`;

    // Speichern der Ergebnisse im localStorage
    localStorage.setItem('tournamentData', JSON.stringify({
      tournament: document.getElementById('tournament').value,
      name: participantName,
      distance: document.getElementById('distance').value,
      target: document.getElementById('target').value,
      round: currentRound,
      totalPoints: totalPoints + roundPoints,
      totalX: totalX + roundX,
      participantsResults: participantsResults.innerHTML,
    }));

    // Wenn Runde 10 erreicht ist, nach Fortsetzung fragen
    if (currentRound === 10) {
      if (confirm("Möchten Sie das Turnier fortsetzen?")) {
        pdfButton.classList.remove('hidden');
      }
    }

    // PDF-Button nach Runde 12 anzeigen
    if (currentRound >= 12) {
      pdfButton.classList.remove('hidden');
    }

    currentRound++;
    roundField.value = currentRound;
  });

  // Formular zurücksetzen
  clearButton.addEventListener('click', () => {
    if (confirm("Sind Sie sicher, dass Sie das Formular löschen möchten?")) {
      localStorage.removeItem('tournamentData');
      location.reload();
    }
  });

  // PDF-Download erstellen
  pdfButton.addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.text('Turnierergebnisse', 10, 10);
    doc.text(`Turniername: ${document.getElementById('tournament').value}`, 10, 20);
    doc.text(`Gesamt X: ${totalX}`, 10, 30);
    doc.text(`Gesamtpunkte: ${totalPoints}`, 10, 40);

    const results = participantsResults.querySelectorAll('tbody tr');
    let yOffset = 50;
    let pageHeight = doc.internal.pageSize.height;

    for (let i = 0; i < results.length; i++) {
      const resultText = results[i].innerText;
      doc.text(resultText, 10, yOffset);
      yOffset += 10;

      // Neue Seite bei Bedarf hinzufügen
      if (yOffset > pageHeight - 20) {
        doc.addPage();
        yOffset = 10;
      }
    }

    doc.save('ergebnisse.pdf');
  });

  // WhatsApp teilen
  function shareResult(name, round, roundPoints, totalPoints) {
    const message = `Turnier: ${document.getElementById('tournament').value}\n` +
                    `Teilnehmer: ${name}\n` +
                    `Runde ${round}: ${roundPoints} Punkte\n` +
                    `Gesamt: ${totalPoints} Punkte`;
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
  }
</script>
</body>
</html>
